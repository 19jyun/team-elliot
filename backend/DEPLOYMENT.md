# ê³ ë„í™”ëœ ë°°í¬ í”„ë¡œì„¸ìŠ¤

## ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ë°°í¬ë¥¼ ìœ„í•œ ê³ ë„í™”ëœ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

### 1. ìŠ¤í‚¤ë§ˆ ë³€ê²½ ê°ì§€

- ë°°í¬ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½ì‚¬í•­ì„ ìë™ìœ¼ë¡œ ê°ì§€
- ë³€ê²½ì‚¬í•­ì´ ì—†ìœ¼ë©´ ë¶ˆí•„ìš”í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê±´ë„ˆëœ€

### 2. ìë™ ë°ì´í„° ë°±ì—…

- ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ê°ì§€ë˜ë©´ ìë™ìœ¼ë¡œ ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
- PostgreSQLì˜ `pg_dump`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•œ ë°±ì—… ìƒì„±
- ë°±ì—… íŒŒì¼ì€ íƒ€ì„ìŠ¤íƒ¬í”„ì™€ í•¨ê»˜ ì €ì¥

### 3. ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜

- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ ë°±ì—…ì—ì„œ ë³µì›
- ë¡¤ë°± ê¸°ëŠ¥ìœ¼ë¡œ ë°ì´í„° ì†ì‹¤ ë°©ì§€

### 4. ìë™ ì •ë¦¬

- 30ì¼ ì´ìƒ ëœ ë°±ì—… íŒŒì¼ ìë™ ì‚­ì œ
- ë””ìŠ¤í¬ ê³µê°„ íš¨ìœ¨ì  ê´€ë¦¬

## ë°°í¬ í”„ë¡œì„¸ìŠ¤

### 1. ìŠ¤í‚¤ë§ˆ ìƒíƒœ í™•ì¸

```bash
npx prisma migrate status
```

### 2. ë³€ê²½ì‚¬í•­ ê°ì§€

- ìŠ¤í‚¤ë§ˆê°€ ìµœì‹  ìƒíƒœì¸ ê²½ìš°: ì• í”Œë¦¬ì¼€ì´ì…˜ ë°”ë¡œ ì‹œì‘
- ë³€ê²½ì‚¬í•­ì´ ìˆëŠ” ê²½ìš°: ë°±ì—… â†’ ë§ˆì´ê·¸ë ˆì´ì…˜ â†’ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘

### 3. ë°±ì—… í”„ë¡œì„¸ìŠ¤

```bash
pg_dump $DATABASE_URL > backup_YYYYMMDD_HHMMSS.sql
```

### 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

```bash
npx prisma migrate deploy
```

### 5. ì‹¤íŒ¨ ì‹œ ë³µì›

```bash
psql $DATABASE_URL < backup_YYYYMMDD_HHMMSS.sql
```

## í™˜ê²½ ë³€ìˆ˜

### í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜

- `DATABASE_URL`: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ìì—´

### ì„ íƒì  í™˜ê²½ ë³€ìˆ˜

- `BACKUP_RETENTION_DAYS`: ë°±ì—… ë³´ê´€ ê¸°ê°„ (ê¸°ë³¸ê°’: 30ì¼)

## ë¡œê·¸ ë©”ì‹œì§€

### ì„±ê³µ ì‹œ

```
ğŸš€ ê³ ë„í™”ëœ ë°°í¬ í”„ë¡œì„¸ìŠ¤ ì‹œì‘...
ğŸ“Š ìŠ¤í‚¤ë§ˆ ë³€ê²½ì‚¬í•­ í™•ì¸ ì¤‘...
âœ… ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆê°€ ìµœì‹  ìƒíƒœì…ë‹ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ğŸš€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤...
```

### ë³€ê²½ì‚¬í•­ ê°ì§€ ì‹œ

```
âš ï¸  ìŠ¤í‚¤ë§ˆ ë³€ê²½ì‚¬í•­ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.
ğŸ“¦ ë°ì´í„° ë°±ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...
âœ… PostgreSQL ë°±ì—… ì™„ë£Œ: /app/backups/backup_20241219_143022.sql
ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤...
âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
ğŸ§¹ ì˜¤ë˜ëœ ë°±ì—… íŒŒì¼ ì •ë¦¬ ì¤‘...
ğŸš€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤...
```

### ì‹¤íŒ¨ ì‹œ

```
âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨!
ğŸ”„ ë°±ì—…ì—ì„œ ë³µì›ì„ ì‹œë„í•©ë‹ˆë‹¤...
âœ… ë°±ì—…ì—ì„œ ë³µì› ì™„ë£Œ
âŒ ë°°í¬ ì‹¤íŒ¨. ìˆ˜ë™ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
```

## ìˆ˜ë™ ì‹¤í–‰

### ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì§ì ‘ ì‹¤í–‰

```bash
./scripts/deploy.sh
```

### í—¬ìŠ¤ì²´í¬ ì‹¤í–‰

```bash
node scripts/health-check.js
```

## ë°±ì—… ê´€ë¦¬

### ë°±ì—… íŒŒì¼ ìœ„ì¹˜

```
/app/backups/
â”œâ”€â”€ backup_20241219_143022.sql
â”œâ”€â”€ backup_20241219_150045.sql
â””â”€â”€ ...
```

### ë°±ì—… íŒŒì¼ ì •ë¦¬

- 30ì¼ ì´ìƒ ëœ ë°±ì—… íŒŒì¼ì€ ìë™ ì‚­ì œ
- ìˆ˜ë™ ì •ë¦¬: `find /app/backups -name "backup_*.sql" -mtime +30 -delete`

## ë¬¸ì œ í•´ê²°

### 1. ê¶Œí•œ ë¬¸ì œ

```bash
chmod +x scripts/deploy.sh
```

### 2. PostgreSQL í´ë¼ì´ì–¸íŠ¸ ì„¤ì¹˜

```bash
# Alpine Linux
apk add --no-cache postgresql-client

# Ubuntu/Debian
apt-get update && apt-get install -y postgresql-client
```

### 3. ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„±

```bash
mkdir -p /app/backups
chown -R nestjs:nodejs /app/backups
```

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ë°±ì—… íŒŒì¼ ë³´ì•ˆ**: ë°±ì—… íŒŒì¼ì€ ë¯¼ê°í•œ ë°ì´í„°ë¥¼ í¬í•¨í•˜ë¯€ë¡œ ì ì ˆí•œ ê¶Œí•œ ì„¤ì • í•„ìš”
2. **í™˜ê²½ ë³€ìˆ˜**: `DATABASE_URL`ì€ ë°˜ë“œì‹œ í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬
3. **ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì€ SSL/TLS ì‚¬ìš© ê¶Œì¥

## ëª¨ë‹ˆí„°ë§

### ë¡œê·¸ í™•ì¸

```bash
docker logs <container_name>
```

### ë°±ì—… ìƒíƒœ í™•ì¸

```bash
ls -la /app/backups/
```

### ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸

```bash
npx prisma migrate status
```
