"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[714],{714:(e,s,t)=>{t.d(s,{V:()=>g});var l=t(5155),n=t(2115),a=t(7733),r=t(3342);function i(e){let{enrollments:s,isLoading:t=!1}=e;return t?(0,l.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-stone-700"})}):s&&0!==s.length?(0,l.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,l.jsx)("div",{className:"font-medium text-stone-700 truncate",children:e.student.name||"수강생"}),e.student.phoneNumber&&(0,l.jsx)("div",{className:"text-sm text-stone-500 truncate",children:e.student.phoneNumber})]}),(0,l.jsx)("div",{className:"ml-3 text-xs text-stone-600",children:e.status||"상태 미정"})]},e.id))}):(0,l.jsx)("div",{className:"text-center py-8 text-stone-500",children:"수강생 정보가 없습니다."})}var o=t(5239),d=t(7787),c=t(9027),u=t(7587);function x(e){let{pose:s,onClick:t,isSelected:n=!1,showAddIcon:a=!1,showDeleteIcon:r=!1,onDeleteClick:i,orderNumber:o}=e;return(0,l.jsx)("div",{className:"relative p-4 rounded-lg border transition-all duration-200 ".concat(r?"bg-white border-gray-200":n?"border-stone-700 bg-stone-50 shadow-md cursor-pointer":"border-gray-200 bg-white hover:border-stone-300 hover:shadow-sm cursor-pointer"),onClick:t,children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[o&&(0,l.jsxs)("span",{className:"text-stone-600 font-medium text-sm",children:[o,"."]}),(0,l.jsx)("h3",{className:"font-medium text-stone-700",children:s.name})]}),a&&(0,l.jsx)("div",{className:"text-stone-400",children:(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),r&&(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),null==i||i()},className:"p-1 text-stone-400 hover:text-stone-600 hover:bg-stone-100 rounded-full transition-colors",children:(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}var m=t(9382);function h(e){let{content:s,index:t,onDeleteClick:n}=e,{attributes:a,listeners:r,setNodeRef:i,transform:o,transition:d}=(0,c.gl)({id:s.id}),m={transform:u.Ks.Transform.toString(o),transition:d},h={...r,onPointerDown:e=>{if(e.target.closest("button"))return void e.stopPropagation();(null==r?void 0:r.onPointerDown)&&r.onPointerDown(e)}};return(0,l.jsxs)("div",{ref:i,style:m,className:"relative",children:[(0,l.jsx)("div",{...a,...h,className:"cursor-move",children:(0,l.jsx)(x,{pose:s.pose,showDeleteIcon:!0,onDeleteClick:()=>n(s.id),orderNumber:t+1})}),s.notes&&(0,l.jsxs)("div",{className:"mt-2 ml-10 bg-stone-50 p-3 rounded-lg text-sm text-stone-600",children:[(0,l.jsx)("span",{className:"font-medium",children:"노트:"})," ",s.notes]})]})}function v(e){let{sessionId:s,onAddPoseClick:t}=e,{data:a,isLoading:r}=(0,m.OD)(s),i=(0,m.oY)(s),u=(0,m.dx)(s),[x,v]=(0,n.useState)([]),[f,p]=(0,n.useState)(!1),j=(0,n.useMemo)(()=>{if(!a||!x)return!1;if(x.length!==a.length)return!0;for(let e=0;e<x.length;e++)if(x[e].id!==a[e].id)return!0;return!1},[a,x]),N=(0,d.FR)((0,d.MS)(d.AN),(0,d.MS)(d.uN,{coordinateGetter:c.JR}));n.useEffect(()=>{a&&(v([...a]),p(!1))},[a]),n.useEffect(()=>{j?p(!0):p(!1)},[j]);let b=e=>{v(s=>s.filter(s=>s.id!==e))},g=async()=>{try{if(!a)return;for(let e of a.filter(e=>!x.some(s=>s.id===e.id)).map(e=>e.id))await i.mutateAsync(e);if(x.length>0){let e=x.map(e=>e.id.toString());await u.mutateAsync({contentIds:e})}p(!1)}catch(e){}};return r?(0,l.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-stone-700"})}):(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-stone-700",children:"수업 내용"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[f&&(0,l.jsx)("button",{onClick:g,className:"px-4 py-2 bg-[#ac9592] text-white rounded-lg hover:bg-[#9a8582] transition-colors text-sm font-bold",children:"변경"}),(0,l.jsx)("button",{onClick:t,className:"px-4 py-2 bg-[#ac9592] text-white rounded-lg hover:bg-[#9a8582] transition-colors text-sm font-bold",children:"자세 추가"})]})]}),x&&x.length>0?(0,l.jsx)(d.Mp,{sensors:N,collisionDetection:d.fp,onDragEnd:e=>{let{active:s,over:t}=e;s.id!==(null==t?void 0:t.id)&&v(e=>{let l=e.findIndex(e=>e.id===s.id),n=e.findIndex(e=>e.id===(null==t?void 0:t.id));return(0,c.be)(e,l,n)})},children:(0,l.jsx)(c.gB,{items:x.map(e=>e.id),strategy:c._G,children:(0,l.jsx)("div",{className:"space-y-2",children:x.map((e,s)=>(0,l.jsx)(h,{content:e,index:s,onDeleteClick:b},e.id))})})}):(0,l.jsx)("div",{className:"flex flex-col h-full",children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 flex-1",children:[(0,l.jsx)(o.default,{src:"/images/logo/team-eliot-2.png",alt:"수업 내용 없음",width:120,height:120}),(0,l.jsx)("p",{className:"mt-4 text-stone-500",children:"아직 추가된 발레 자세가 없습니다."}),(0,l.jsx)("p",{className:"text-sm text-stone-400 mt-1",children:"자세 추가 버튼을 눌러 수업 내용을 구성해보세요."})]})})]})}var f=t(131),p=t(2052);function j(e){let{isOpen:s,onClose:t,onSelect:a,selectedPoseId:i}=e,[o,d]=(0,n.useState)("ALL"),{data:c,isLoading:u,error:m}=(e=>{let{fetchBalletPoses:s}=(0,p.W)();return(0,f.I)({queryKey:["ballet-poses",void 0],queryFn:()=>s(void 0),staleTime:3e5})})(),h=(null==c?void 0:c.filter(e=>"ALL"===o||e.difficulty===o))||[];return(0,l.jsx)(r.g,{isOpen:s,onClose:t,title:"발레 자세 선택",contentClassName:"pb-6",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 py-4",children:[{value:"ALL",label:"전체"},{value:"BEGINNER",label:"초급"},{value:"INTERMEDIATE",label:"중급"},{value:"ADVANCED",label:"고급"}].map(e=>(0,l.jsx)("button",{onClick:()=>d(e.value),className:"px-3 py-2 text-sm font-medium rounded-lg whitespace-nowrap transition-colors ".concat(o===e.value?"bg-stone-700 text-white":"bg-stone-100 text-stone-700 hover:bg-stone-200"),children:e.label},e.value))}),u?(0,l.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-stone-700"})}):m?(0,l.jsx)("div",{className:"text-center py-8 text-stone-500",children:"발레 자세를 불러올 수 없습니다."}):0===h.length?(0,l.jsx)("div",{className:"text-center py-8 text-stone-500",children:"선택한 난이도의 발레 자세가 없습니다."}):(0,l.jsx)("div",{className:"grid grid-cols-1 gap-2 max-h-96 overflow-y-auto",children:h.map(e=>(0,l.jsx)(x,{pose:e,onClick:()=>{a(e),t()},isSelected:i===e.id,showAddIcon:!0},e.id))})]})})}var N=t(6983);let b={primary:"stone-700",secondary:"stone-500",hover:"stone-600"};function g(e){var s,t,o;let{isOpen:d,sessionId:c,onClose:u,role:x,showNavigation:h=!0,defaultTab:f="overview"}=e,[g,y]=(0,n.useState)(f),[w,C]=(0,n.useState)(null),[E,k]=(0,n.useState)(!1),[S,D]=(0,n.useState)(!1),I=(0,m.yB)(c||0),L=(0,p.W)(),A=(0,N.g)(),{sessions:T,loadSessions:M,loadSessionEnrollments:P}=L,{sessions:B,loadSessions:O,loadSessionEnrollments:R}=A,G="teacher"===x?B:T,_=(0,n.useMemo)(()=>c&&G?G.find(e=>e.id===c):null,[c,G]),F="teacher"===x||"principal"===x,K=(0,n.useCallback)(async()=>{try{let e;if(D(!0),"principal"===x)e=await P(c);else if("teacher"===x)e=await R(c);else throw Error("지원하지 않는 역할입니다.");C(e||null)}catch(e){}finally{D(!1)}},[x,c,P,R]);(0,n.useEffect)(()=>{d&&c&&F?K():(C(null),D(!1))},[d,c,F,K]),(0,n.useEffect)(()=>{d&&c&&("teacher"===x?O():"principal"===x&&M())},[d,c,x,O,M]),(0,n.useEffect)(()=>{d&&c&&(y(f),k(!1))},[d,c,f]);let W=e=>("string"==typeof e?new Date(e):e).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",hour12:!1}),V=e=>({PENDING:"대기",CONFIRMED:"확정",CANCELLED:"취소",ATTENDED:"출석",ABSENT:"결석",COMPLETED:"완료"})[e]||e,q=e=>({PENDING:"text-yellow-600 bg-yellow-100",CONFIRMED:"text-green-600 bg-green-100",CANCELLED:"text-red-600 bg-red-100",ATTENDED:"text-blue-600 bg-blue-100",ABSENT:"text-gray-600 bg-gray-100",COMPLETED:"text-purple-600 bg-purple-100"})[e]||"text-gray-600 bg-gray-100",H=(()=>{let e=[{label:"개요",value:"overview"}];return F&&e.push({label:"출석체크",value:"attendance"},{label:"수업 내용",value:"content"}),e})();return _?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(r.g,{isOpen:d,onClose:u,title:"".concat("class"in _?null==(s=_.class)?void 0:s.className:"클래스"," - ").concat(W(null==_?void 0:_.startTime)),contentClassName:"pb-6",children:[h&&(0,l.jsx)("div",{className:"flex border-b border-stone-200 mb-4",children:H.map(e=>(0,l.jsx)("button",{onClick:()=>y(e.value),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors duration-200 ".concat(g===e.value?"text-".concat(b.primary," border-b-2 border-").concat(b.primary):"text-".concat(b.secondary," hover:text-").concat(b.hover)),children:e.label},e.value))}),(0,l.jsx)("div",{className:"relative w-full overflow-hidden",style:{height:"500px"},children:(0,l.jsxs)(a.P.div,{className:"flex w-full",style:{width:"300%"},animate:{x:-(33.333*H.findIndex(e=>e.value===g))+"%"},transition:{type:"tween",duration:.3,ease:"easeInOut"},children:[(0,l.jsx)("div",{className:"w-1/3 flex-shrink-0 px-1",children:(0,l.jsx)("div",{className:"h-full overflow-y-auto",children:(0,l.jsx)("div",{className:"space-y-6",children:w?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"bg-stone-50 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-stone-600",children:"수강생 현황"}),(0,l.jsxs)("span",{className:"text-sm text-stone-500",children:[w.totalCount,"명"]})]}),(0,l.jsx)("div",{className:"flex gap-2 text-xs",children:Object.entries(w.statusCounts).map(e=>{let[s,t]=e;return t>0&&(0,l.jsxs)("span",{className:"px-2 py-1 rounded ".concat(q(s)),children:[V(s),": ",t,"명"]},s)})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-base font-semibold text-stone-700 mb-3",children:"수강생 목록"}),(0,l.jsx)("div",{className:"space-y-3",children:null==(t=w.enrollments)?void 0:t.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"font-medium text-stone-700",children:e.student.name}),e.student.phoneNumber&&(0,l.jsx)("div",{className:"text-sm text-stone-500",children:e.student.phoneNumber})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(q(e.status)),children:V(e.status)}),e.payment&&(0,l.jsx)("span",{className:"text-xs text-green-600",children:"결제완료"})]})]},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-base font-semibold text-stone-700 mb-3",children:"클래스 정보"}),(0,l.jsx)("div",{className:"bg-stone-50 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-stone-600",children:"클래스명:"}),(0,l.jsx)("span",{className:"text-stone-700",children:"class"in _?null==(o=_.class)?void 0:o.className:"클래스"})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-stone-600",children:"날짜:"}),(0,l.jsx)("span",{className:"text-stone-700",children:new Date(_.date).toLocaleDateString()})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-stone-600",children:"시간:"}),(0,l.jsxs)("span",{className:"text-stone-700",children:[W(_.startTime)," - ",W(_.endTime)]})]})]})})]})]}):(0,l.jsx)("div",{className:"text-center py-8 text-stone-500",children:"수강생 정보를 불러올 수 없습니다."})})})}),F&&(0,l.jsx)("div",{className:"w-1/3 flex-shrink-0 px-1",children:(0,l.jsx)("div",{className:"h-full overflow-y-auto",children:(0,l.jsx)(i,{sessionId:_.id,enrollments:(null==w?void 0:w.enrollments)||[],isLoading:S})})}),F&&(0,l.jsx)("div",{className:"w-1/3 flex-shrink-0 px-1",children:(0,l.jsx)("div",{className:"h-full overflow-y-auto",children:(0,l.jsx)(v,{sessionId:_.id,onAddPoseClick:()=>k(!0)})})})]})})]}),F&&(0,l.jsx)(j,{isOpen:E,onClose:()=>k(!1),onSelect:e=>{I.mutate({poseId:e.id}),k(!1)}})]}):null}},6983:(e,s,t)=>{t.d(s,{g:()=>i});var l=t(2115),n=t(4582),a=t(821),r=t(6334);function i(){var e;let{data:s,status:t}=(0,n.wV)(),{}=(0,r.C)(),[i,o]=(0,l.useState)(null),[d,c]=(0,l.useState)(null),[u,x]=(0,l.useState)([]),[m,h]=(0,l.useState)([]),[v,f]=(0,l.useState)(!1),[p,j]=(0,l.useState)(null),N="authenticated"===t&&(null==s||null==(e=s.user)?void 0:e.role)==="TEACHER",b=(0,l.useCallback)(async()=>{if(N)try{j(null);let e=await (0,a.KG)();o(e.data||null)}catch(t){var e,s;j((null==(s=t.response)||null==(e=s.data)?void 0:e.message)||"프로필 로드 실패")}},[N]),g=(0,l.useCallback)(async()=>{if(N)try{j(null);let e=await (0,a.np)();c(e.data||null)}catch(t){var e,s;j((null==(s=t.response)||null==(e=s.data)?void 0:e.message)||"학원 정보 로드 실패")}},[N]),y=(0,l.useCallback)(async()=>{if(N)try{j(null);let e=(await (0,a.Ef)()).data;e&&(x(e.classes||[]),h(e.sessions||[]))}catch(t){var e,s;j((null==(s=t.response)||null==(e=s.data)?void 0:e.message)||"클래스 및 세션 목록 로드 실패")}},[N]),w=(0,l.useCallback)(async e=>{if(!N||!e)return null;try{return j(null),(await (0,a.U_)(e)).data}catch(e){var s,t;return j((null==(t=e.response)||null==(s=t.data)?void 0:s.message)||"수강생 목록 로드 실패"),null}},[N]),C=(0,l.useCallback)(async(e,s)=>{if(!N)return null;try{return j(null),(await (0,a.Yi)(e,s)).data}catch(e){var t,l;return j((null==(l=e.response)||null==(t=l.data)?void 0:t.message)||"수강생 상태 업데이트 실패"),null}},[N]),E=(0,l.useCallback)(async e=>{if(!N)return null;try{j(null);let s=await (0,a.P_)(e);return await b(),s.data}catch(e){var s,t;return j((null==(t=e.response)||null==(s=t.data)?void 0:s.message)||"프로필 업데이트 실패"),null}},[N,b]),k=(0,l.useCallback)(async e=>{if(!N)return null;try{return j(null),(await (0,a.D9)(e)).data}catch(e){var s,t;return j((null==(t=e.response)||null==(s=t.data)?void 0:s.message)||"프로필 사진 업데이트 실패"),null}},[N]),S=(0,l.useCallback)(async(e,s)=>{if(!N)return null;try{return j(null),(await (0,a.Mu)(e,s)).data}catch(e){var t,l;return j((null==(l=e.response)||null==(t=l.data)?void 0:t.message)||"클래스 정보 업데이트 실패"),null}},[N]),D=async()=>{if(N)try{f(!0),j(null),await Promise.all([b(),g(),y()])}catch(t){var e,s;j((null==(s=t.response)||null==(e=s.data)?void 0:e.message)||"데이터 로드 실패")}finally{f(!1)}},I=(0,l.useCallback)(async e=>{try{if(j(null),!e)return null;if(i&&i.id===e)return i;return(await (0,a.KG)()).data}catch(e){var s,t;return j((null==(t=e.response)||null==(s=t.data)?void 0:s.message)||"프로필 로드 실패"),null}},[i]);return{profile:i,academy:d,classes:u,sessions:m,isLoading:v,error:p,isTeacher:N,loadProfile:b,loadAcademy:g,loadClasses:y,loadSessions:y,loadAllData:D,loadSessionEnrollments:w,updateEnrollmentStatus:C,updateProfile:E,updateProfilePhoto:k,updateClassDetails:S,loadProfileById:I,getClassById:e=>u.find(s=>s.id===e),getSessionById:e=>m.find(s=>s.id===e),getSessionsByClassId:e=>m.filter(s=>s.class.id===e),getSessionsByDate:e=>m.filter(s=>new Date(s.date).toDateString()===e.toDateString()),getTeacherById:e=>i}}}}]);